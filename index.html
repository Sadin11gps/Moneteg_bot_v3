<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Earning ~√ó‚Ä¢RDS TEAM‚Ä¢√ó~</title>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700&display=swap" rel="stylesheet">
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" />

    <style>
        /* Google Font Import */
        @import url('https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700&display=swap');

        /* CSS Variables for Theming - KEPT ORIGINAL */
        :root {
            --font-family: 'Nunito', sans-serif;
            --bg-color: #121212; /* Dark theme background */
            --secondary-bg: #1e1e1e;
            --text-color: #ffffff;
            --subtle-text: #b0b0b0;
            --primary-color: #3498db; /* Blue */
            --accent-color: #f39c12; /* Orange */
            --sparkle-color: #e74c3c; /* Red/Sparkle */
            --success-color: #2ecc71; /* Green */
            --danger-color: #e74c3c; /* Red */
            --glow-shadow: 0 0 10px rgba(231, 76, 60, 0.4);
            --card-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
            --border-radius: 12px;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; }

        body {
            font-family: var(--font-family);
            background-color: var(--bg-color);
            color: var(--text-color);
            line-height: 1.6;
            padding-bottom: 70px; /* Space for fixed bottom navigation */
        }
        
        /* ... (All your original CSS classes remain unchanged) ... */
        .py-2 { padding-top: 0.5rem; padding-bottom: 0.5rem; }
        .mt-4 { margin-top: 1rem; }
        .mt-3 { margin-top: 0.75rem; }
        .mb-4 { margin-bottom: 1rem; }
        .mr-2 { margin-right: 0.5rem; }
        .p-4 { padding: 1rem; }
        .text-center { text-align: center; }
        .font-bold { font-weight: 700; }
        .hidden { display: none !important; }

        .container { max-width: 500px; margin: 0 auto; padding: 0 15px; }
        
        .page { display: none; padding-top: 10px; min-height: calc(100vh - 80px); }
        .page.active { display: block; }

        .card, .referral-box {
            background-color: var(--secondary-bg); padding: 15px; border-radius: var(--border-radius);
            box-shadow: var(--card-shadow); margin-bottom: 15px;
        }
        
        .profile-header { display: flex; align-items: center; padding: 15px 0; border-bottom: 1px solid #333; margin-bottom: 20px; }
        .user-photo-placeholder { width: 60px; height: 60px; border-radius: 50%; object-fit: cover; margin-right: 15px; border: 3px solid var(--primary-color); }
        .user-info .user-name { font-size: 1.4rem; margin: 0; color: var(--sparkle-color); }
        .user-info .user-id-text { font-size: 0.8rem; color: var(--subtle-text); margin: 0; }
        
        .balance-section { display: flex; justify-content: space-around; text-align: center; }
        .balance-card { flex: 1; padding: 15px; margin: 0 5px; border-radius: var(--border-radius); background: #252525; box-shadow: inset 0 0 5px rgba(0, 0, 0, 0.5); border: 1px solid #333; }
        .balance-label { font-size: 0.8rem; color: var(--subtle-text); margin-bottom: 5px; }
        .balance-value { font-size: 1.5rem; font-weight: 700; color: var(--success-color); }
        
        .stats-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px; margin-top: 20px; }
        .stat-card { background-color: #252525; padding: 15px; border-radius: var(--border-radius); text-align: center; border-left: 5px solid var(--accent-color); }
        .stat-icon { color: var(--accent-color); font-size: 1.5rem; margin-bottom: 5px; }
        .stat-value { font-size: 1.6rem; font-weight: 700; color: var(--sparkle-color); }
        .stat-label { font-size: 0.8rem; color: var(--subtle-text); }

        .btn-primary { display: block; width: 100%; padding: 12px; border: none; border-radius: 8px; font-size: 1rem; font-weight: 700; cursor: pointer; transition: all 0.3s ease; text-align: center; text-decoration: none; background-color: var(--primary-color); color: var(--text-color); box-shadow: 0 4px 10px rgba(52, 152, 219, 0.4); }
        .btn-primary:hover:not(:disabled) { background-color: #2980b9; }
        .btn-primary:disabled { background-color: #5d6d7e; cursor: not-allowed; opacity: 0.7; }
        
        .referral-input-group { display: flex; margin-bottom: 15px; }
        #referral-link-input { flex-grow: 1; padding: 10px; border: 1px solid #444; border-radius: 8px 0 0 8px; background-color: #2c2c2c; color: var(--text-color); font-size: 0.9rem; overflow: hidden; white-space: nowrap; text-overflow: ellipsis; }
        .btn-copy { padding: 10px 15px; border: none; border-radius: 0 8px 8px 0; background-color: var(--accent-color); transition: background-color 0.3s; color: white; cursor: pointer; }
        .btn-copy:hover { background-color: #e67e22; }
        
        .ad-button-container { margin-top: 20px; }
        
        /* Wallet Styles */
        .wallet-select-group { margin-bottom: 15px; display: flex; gap: 10px; }
        .wallet-select-group label { flex: 1; display: flex; align-items: center; padding: 10px; background-color: #252525; border-radius: 8px; cursor: pointer; border: 2px solid #252525; transition: border-color 0.3s; }
        .wallet-select-group input[type="radio"]:checked + label { border-color: var(--primary-color); background-color: #1a1a1a; }
        .wallet-select-group input[type="radio"] { margin-right: 10px; }
        .wallet-select-group span { font-size: 0.9rem; font-weight: 600; }

        form label { display: block; margin-bottom: 8px; font-size: 0.9rem; color: var(--subtle-text); }
        form select, form input[type="text"], form input[type="number"] { width: 100%; padding: 12px; margin-bottom: 15px; border: 1px solid #444; border-radius: 8px; background-color: #2c2c2c; color: var(--text-color); font-size: 1rem; }
        
        .referral-check-box { border: 1px solid #444; border-left: 5px solid var(--danger-color); padding: 10px; border-radius: 8px; background-color: #1a1a1a; font-size: 0.9rem; margin-bottom: 15px; }
        .history-list { list-style: none; padding: 0; }
        
        .bottom-nav { position: fixed; bottom: 0; left: 0; right: 0; height: 60px; display: flex; justify-content: space-around; background-color: #1e1e1e; border-top: 1px solid #333; box-shadow: 0 -4px 10px rgba(0, 0, 0, 0.5); z-index: 1000; max-width: 500px; margin: 0 auto; }
        .nav-btn { background: none; border: none; color: var(--subtle-text); padding: 10px 0; flex: 1; font-size: 0.7rem; display: flex; flex-direction: column; align-items: center; cursor: pointer; transition: color 0.3s ease; }
        .nav-btn i { font-size: 1.2rem; margin-bottom: 4px; }
        .nav-btn.active { color: var(--sparkle-color); text-shadow: 0 0 5px rgba(231, 76, 60, 0.8); }
        
        /* Modal */
        .modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0, 0, 0, 0.7); display: flex; justify-content: center; align-items: center; z-index: 2000; transition: opacity 0.3s; }
        .modal-content { background-color: var(--secondary-bg); padding: 20px; border-radius: var(--border-radius); width: 90%; max-width: 400px; box-shadow: var(--glow-shadow); text-align: center; max-height: 90vh; overflow-y: auto; }
        .modal-header { display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid #333; padding-bottom: 10px; margin-bottom: 15px; }
        .modal-body textarea { width: 100%; height: 150px; padding: 10px; background-color: #2c2c2c; border: 1px solid #444; border-radius: 8px; color: var(--text-color); font-size: 0.9rem; resize: none; }
        
        .loader { border: 5px solid #333; border-top: 5px solid var(--primary-color); border-radius: 50%; width: 50px; height: 50px; animation: spin 1s linear infinite; margin: 0 auto 10px; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

        /* NEW STYLES FOR MICRO JOBS */
        .job-card { border-left: 4px solid var(--warning-color); margin-top: 15px; }
        .job-item { background-color: #252525; padding: 12px; border-radius: 8px; margin-bottom: 10px; display: flex; justify-content: space-between; align-items: center; }
        .job-info h4 { margin: 0; font-size: 1rem; color: var(--text-color); }
        .job-info p { margin: 0; font-size: 0.8rem; color: var(--success-color); font-weight: bold; }
        .job-btn { padding: 5px 15px; font-size: 0.9rem; background-color: var(--primary-color); color: white; border: none; border-radius: 5px; cursor: pointer; }
        .job-btn:disabled { background-color: #555; }

        /* Upload Area */
        .upload-area { border: 2px dashed #555; padding: 15px; text-align: center; border-radius: 8px; margin-bottom: 15px; cursor: pointer; position: relative; }
        .upload-area input[type="file"] { position: absolute; top: 0; left: 0; width: 100%; height: 100%; opacity: 0; cursor: pointer; }
        .upload-preview { max-width: 100%; max-height: 150px; margin-top: 10px; display: none; border-radius: 5px; }
        .modal-body input[type="text"] { margin-bottom: 15px; }
    </style>
</head>

<body>
    <div class="container">
        
        <!-- Home Page -->
        <div id="home-page" class="page active">
            <div class="profile-header">
                <img id="user-photo" src="https://placehold.co/60x60/3498db/ffffff?text=L" alt="User Photo" class="user-photo-placeholder">
                <div class="user-info">
                    <h1 class="user-name" id="user-name">Loading...</h1>
                    <p class="user-id-text">ID: <span id="user-id">Loading...</span></p>
                </div>
            </div>

            <div class="balance-section mb-4">
                <div class="balance-card">
                    <div class="balance-label">‡¶Æ‡ßã‡¶ü ‡¶Æ‡ßá‡¶á‡¶® ‡¶¨‡ßç‡¶Ø‡¶æ‡¶≤‡ßá‡¶®‡ßç‡¶∏</div>
                    <div class="balance-value" id="main-balance">0.00 TK</div>
                </div>
                <div class="balance-card">
                    <div class="balance-label">‡¶Æ‡ßã‡¶ü ‡¶∞‡ßá‡¶´‡¶æ‡¶∞ ‡¶¨‡ßç‡¶Ø‡¶æ‡¶≤‡ßá‡¶®‡ßç‡¶∏</div>
                    <div class="balance-value" id="refer-balance">0.00 TK</div>
                </div>
            </div>

            <div class="stats-grid">
                <div class="stat-card">
                    <i class="fas fa-users stat-icon"></i>
                    <div class="stat-value" id="total-referrals">0</div>
                    <div class="stat-label">‡¶Æ‡ßã‡¶ü ‡¶∞‡ßá‡¶´‡¶æ‡¶∞‡ßá‡¶≤</div>
                </div>
                <div class="stat-card">
                    <i class="fas fa-eye stat-icon"></i>
                    <div class="stat-value" id="daily-ads-watched">0</div>
                    <div class="stat-label">‡¶Ü‡¶ú‡¶ï‡ßá‡¶∞ ‡¶ï‡¶æ‡¶ú</div>
                </div>
            </div>

            <div class="referral-box mt-4">
                <h3 style="color: var(--sparkle-color); margin-bottom: 10px;"><i class="fas fa-share-alt mr-2"></i> ‡¶∞‡ßá‡¶´‡¶æ‡¶∞‡ßá‡¶≤ ‡¶≤‡¶ø‡¶Ç‡¶ï</h3>
                <div class="referral-input-group">
                    <input type="text" id="referral-link-input" value="Loading Referral Link..." readonly>
                    <button id="copy-referral-btn" class="btn-copy">
                        <i class="fas fa-copy"></i> ‡¶ï‡¶™‡¶ø
                    </button>
                </div>
                <button id="generate-message-btn" class="btn-primary mt-3" style="background-color: #8e44ad;">
                    <i class="fas fa-lightbulb mr-2"></i> ‡¶∞‡ßá‡¶´‡¶æ‡¶∞‡ßá‡¶≤ ‡¶Æ‡ßá‡¶∏‡ßá‡¶ú ‡¶§‡ßà‡¶∞‡¶ø ‡¶ï‡¶∞‡ßÅ‡¶® (Gemini AI)
                </button>
            </div>
        </div>
        
        <!-- TASK PAGE -->
        <div id="task-page" class="page">
            <h2 class="py-2" style="border-bottom: 1px solid #333;">‡¶¶‡ßà‡¶®‡¶ø‡¶ï ‡¶ï‡¶æ‡¶ú</h2>

            <!-- Original Ad Task -->
            <div class="card mt-4 text-center">
                <h3 style="color: var(--accent-color);"><i class="fas fa-ad"></i> ‡¶¨‡¶ø‡¶ú‡ßç‡¶û‡¶æ‡¶™‡¶® ‡¶¶‡ßá‡¶ñ‡ßÅ‡¶®</h3>
                <p style="color: var(--subtle-text); margin-top: 10px;">‡¶™‡ßç‡¶∞‡¶§‡¶ø‡¶ü‡¶ø ‡¶¨‡¶ø‡¶ú‡ßç‡¶û‡¶æ‡¶™‡¶® ‡¶¶‡ßá‡¶ñ‡¶æ‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶Ü‡¶™‡¶®‡¶ø ‡¶™‡¶æ‡¶¨‡ßá‡¶® 0.50 TK‡•§</p>
                
                <div class="stat-card mt-3">
                    <i class="fas fa-calendar-day stat-icon"></i>
                    <div class="stat-value" id="task-ad-count">0</div>
                    <div class="stat-label">‡¶Ü‡¶ú ‡¶¶‡ßá‡¶ñ‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá</div>
                </div>

                <div class="ad-button-container mt-4">
                    <button id="watch-ad-btn" class="btn-primary" style="background-color: var(--success-color);">
                        <i class="fas fa-video mr-2"></i> ‡¶¨‡¶ø‡¶ú‡ßç‡¶û‡¶æ‡¶™‡¶® ‡¶¶‡ßá‡¶ñ‡ßÅ‡¶® (Watch Ad)
                    </button>
                </div>
            </div>
            
            <!-- Moneteg Ad Container -->
            <div id="ad-container" class="mt-4"></div>

            <!-- NEW: Micro Jobs Section -->
            <div class="card job-card mt-4">
                <h3 style="color: var(--warning-color); margin-bottom: 15px;">‡¶Æ‡¶æ‡¶á‡¶ï‡ßç‡¶∞‡ßã ‡¶ú‡¶¨ (Micro Jobs)</h3>
                <p style="color: var(--subtle-text); font-size: 0.9rem; margin-bottom: 15px;">‡¶™‡ßç‡¶∞‡¶§‡¶ø‡¶ü‡¶ø ‡¶ï‡¶æ‡¶ú‡ßá‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡ß´ ‡¶ü‡¶æ‡¶ï‡¶æ‡•§ ‡¶¶‡ßà‡¶®‡¶ø‡¶ï ‡ß´‡¶ü‡¶ø ‡¶ï‡¶æ‡¶ú‡•§</p>
                
                <div id="micro-jobs-list">
                    <!-- Dynamic Job List -->
                </div>
            </div>
        </div>
        
        <!-- Withdraw Page (Existing) -->
        <div id="withdraw-page" class="page">
            <h2 class="py-2" style="border-bottom: 1px solid #333;">‡¶â‡¶§‡ßç‡¶§‡ßã‡¶≤‡¶®</h2>

            <div class="balance-card mt-4">
                <div class="balance-label">‡¶Æ‡ßã‡¶ü ‡¶â‡¶§‡ßç‡¶§‡ßã‡¶≤‡¶®‡ßá‡¶∞ ‡¶Ø‡ßã‡¶ó‡ßç‡¶Ø ‡¶¨‡ßç‡¶Ø‡¶æ‡¶≤‡ßá‡¶®‡ßç‡¶∏</div>
                <div class="balance-value" id="total-withdrawable-balance" style="color: var(--sparkle-color);">0.00 TK</div>
            </div>
            
            <div id="referral-check-block" class="referral-check-box mt-4">
                <p id="referral-check-text">‡¶â‡¶á‡¶•‡¶°‡ßç‡¶∞‡¶Ø‡¶º‡¶æ‡¶≤‡ßá‡¶∞ ‡¶∂‡¶∞‡ßç‡¶§ ‡¶Ø‡¶æ‡¶ö‡¶æ‡¶á ‡¶ï‡¶∞‡¶æ ‡¶π‡¶ö‡ßç‡¶õ‡ßá...</p>
            </div>

            <p id="ref-status-notice" class="hidden" style="color: var(--danger-color); font-size: 0.9rem; text-align: center; margin-bottom: 15px;">
                <i class="fas fa-exclamation-triangle mr-2"></i> ‡¶∂‡¶∞‡ßç‡¶§ ‡¶™‡ßÇ‡¶∞‡¶£ ‡¶®‡¶æ ‡¶π‡¶ì‡¶Ø‡¶º‡¶æ ‡¶™‡¶∞‡ßç‡¶Ø‡¶®‡ßç‡¶§ ‡¶â‡¶§‡ßç‡¶§‡ßã‡¶≤‡¶® ‡¶∏‡¶Æ‡ßç‡¶≠‡¶¨ ‡¶®‡¶Ø‡¶º‡•§
            </p>

            <form id="withdraw-form" class="card">
                <h3 style="color: var(--primary-color); margin-bottom: 20px;"><i class="fas fa-wallet"></i> ‡¶â‡¶§‡ßç‡¶§‡ßã‡¶≤‡¶®‡ßá‡¶∞ ‡¶´‡¶∞‡ßç‡¶Æ</h3>
                
                <label style="font-weight: bold; color: var(--text-color);">‡¶ï‡ßã‡¶® ‡¶¨‡ßç‡¶Ø‡¶æ‡¶≤‡ßá‡¶®‡ßç‡¶∏ ‡¶•‡ßá‡¶ï‡ßá ‡¶â‡¶§‡ßç‡¶§‡ßã‡¶≤‡¶® ‡¶ï‡¶∞‡¶¨‡ßá‡¶®?</label>
                <div class="wallet-select-group">
                    <label class="radio-option">
                        <input type="radio" name="wallet" value="main" checked>
                        <span>‡¶Æ‡ßá‡¶á‡¶® ‡¶¨‡ßç‡¶Ø‡¶æ‡¶≤‡ßá‡¶®‡ßç‡¶∏</span>
                    </label>
                    <label class="radio-option">
                        <input type="radio" name="wallet" value="refer">
                        <span>‡¶∞‡ßá‡¶´‡¶æ‡¶∞ ‡¶¨‡ßç‡¶Ø‡¶æ‡¶≤‡ßá‡¶®‡ßç‡¶∏</span>
                    </label>
                    <input type="hidden" id="wallet-select" value="main"> 
                </div>
                
                <div style="display: flex; justify-content: space-between; margin-bottom: 15px; font-size: 0.8rem; color: var(--subtle-text);">
                     <span>‡¶Æ‡ßá‡¶á‡¶®: <span id="main-balance-withdraw">0.00 TK</span></span>
                     <span>‡¶∞‡ßá‡¶´‡¶æ‡¶∞: <span id="refer-balance-withdraw">0.00 TK</span></span>
                </div>

                <label for="amount-input">‡¶â‡¶§‡ßç‡¶§‡ßã‡¶≤‡¶®‡ßá‡¶∞ ‡¶™‡¶∞‡¶ø‡¶Æ‡¶æ‡¶£ (‡¶®‡ßç‡¶Ø‡ßÇ‡¶®‡¶§‡¶Æ 100 TK)</label>
                <input type="number" id="amount-input" placeholder="‡¶ü‡¶æ‡¶ï‡¶æ‡¶∞ ‡¶™‡¶∞‡¶ø‡¶Æ‡¶æ‡¶£ ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®" min="100">

                <label for="method-select">‡¶Æ‡¶æ‡¶ß‡ßç‡¶Ø‡¶Æ ‡¶®‡¶ø‡¶∞‡ßç‡¶¨‡¶æ‡¶ö‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®</label>
                <select id="method-select">
                    <option value="bkash">Bkash Personal</option>
                    <option value="nagad">Nagad Personal</option>
                    <option value="rocket">Rocket Personal</option>
                </select>

                <label for="number-input">‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶®‡¶æ‡¶Æ‡ßç‡¶¨‡¶æ‡¶∞</label>
                <input type="text" id="number-input" placeholder="‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶´‡ßã‡¶® ‡¶®‡¶æ‡¶Æ‡ßç‡¶¨‡¶æ‡¶∞ ‡¶¶‡¶ø‡¶®">

                <button type="submit" id="withdraw-submit-btn" class="btn-primary mt-4" disabled>
                    <i class="fas fa-paper-plane mr-2"></i> ‡¶â‡¶§‡ßç‡¶§‡ßã‡¶≤‡¶®‡ßá‡¶∞ ‡¶Ö‡¶®‡ßÅ‡¶∞‡ßã‡¶ß ‡¶™‡¶æ‡¶†‡¶æ‡¶®
                </button>
            </form>
        </div>

        <!-- History Page -->
        <div id="history-page" class="page">
            <h2 class="py-2" style="border-bottom: 1px solid #333;">‡¶â‡¶§‡ßç‡¶§‡ßã‡¶≤‡¶®‡ßá‡¶∞ ‡¶á‡¶§‡¶ø‡¶π‡¶æ‡¶∏</h2>
            <div id="history-list" class="history-list mt-4">
                <div class="card p-4 text-center">
                    <i class="fas fa-spinner fa-spin fa-2x" style="color: var(--primary-color);"></i>
                    <p class="mt-2" style="color: var(--subtle-text);">‡¶á‡¶§‡¶ø‡¶π‡¶æ‡¶∏ ‡¶≤‡ßã‡¶° ‡¶π‡¶ö‡ßç‡¶õ‡ßá...</p>
                </div>
            </div>
        </div>

        <!-- Support Page -->
        <div id="support-page" class="page">
            <h2 class="py-2" style="border-bottom: 1px solid #333;">‡¶∏‡¶æ‡¶™‡ßã‡¶∞‡ßç‡¶ü ‡¶ì ‡¶∏‡¶æ‡¶π‡¶æ‡¶Ø‡ßç‡¶Ø</h2>
            <div class="referral-box mt-4">
                <h3 style="color: var(--sparkle-color);"><i class="fas fa-question-circle"></i> ‡¶∏‡¶æ‡¶ß‡¶æ‡¶∞‡¶£ ‡¶™‡ßç‡¶∞‡¶∂‡ßç‡¶®</h3>
                <p style="color: var(--subtle-text); margin-top: 10px;">‡¶Ü‡¶Æ‡¶æ‡¶¶‡ßá‡¶∞ ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶™ ‡¶∏‡¶Æ‡ßç‡¶™‡¶∞‡ßç‡¶ï‡ßá ‡¶∏‡¶æ‡¶ß‡¶æ‡¶∞‡¶£ ‡¶™‡ßç‡¶∞‡¶∂‡ßç‡¶®‡ßá‡¶∞ ‡¶â‡¶§‡ßç‡¶§‡¶∞ ‡¶ú‡¶æ‡¶®‡¶§‡ßá ‡¶¨‡¶æ ‡¶ï‡ßã‡¶®‡ßã ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ ‡¶∞‡¶ø‡¶™‡ßã‡¶∞‡ßç‡¶ü ‡¶ï‡¶∞‡¶§‡ßá ‡¶®‡¶ø‡¶ö‡ßá‡¶∞ ‡¶¨‡¶æ‡¶ü‡¶®‡¶ü‡¶ø ‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡¶æ‡¶∞ ‡¶ï‡¶∞‡ßÅ‡¶®‡•§</p>
                <a id="support-bot-link" href="#" target="_blank" class="btn-primary" style="background-color: #2980b9;">
                    <i class="fab fa-telegram-plane mr-2"></i> ‡¶∏‡¶∞‡¶æ‡¶∏‡¶∞‡¶ø ‡¶∏‡¶æ‡¶™‡ßã‡¶∞‡ßç‡¶ü ‡¶Æ‡ßá‡¶∏‡ßá‡¶ú
                </a>
            </div>
            
            <div class="referral-box mt-4">
                <h3 style="color: var(--sparkle-color);"><i class="fas fa-info-circle"></i> ‡¶ó‡ßÅ‡¶∞‡ßÅ‡¶§‡ßç‡¶¨‡¶™‡ßÇ‡¶∞‡ßç‡¶£ ‡¶§‡¶•‡ßç‡¶Ø</h3>
                <ul style="list-style: none; padding: 0; color: var(--subtle-text); font-size: 0.9rem;">
                    <li style="margin-bottom: 8px;"><i class="fas fa-check-circle mr-2" style="color: var(--accent-color);"></i> ‡¶™‡ßç‡¶∞‡¶§‡¶ø ‡¶∞‡ßá‡¶´‡¶æ‡¶∞‡ßá ‡¶Ü‡¶™‡¶®‡¶ø ‡¶™‡¶æ‡¶¨‡ßá‡¶® <span style="color: var(--sparkle-color); font-weight: bold;">30 TK</span>‡•§</li>
                    <li style="margin-bottom: 8px;"><i class="fas fa-check-circle mr-2" style="color: var(--accent-color);"></i> ‡¶â‡¶§‡ßç‡¶§‡ßã‡¶≤‡¶®‡ßá‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø <span style="color: var(--sparkle-color); font-weight: bold;">20 ‡¶ú‡¶® ‡¶∞‡ßá‡¶´‡¶æ‡¶∞</span> ‡¶Ü‡¶¨‡¶∂‡ßç‡¶Ø‡¶ø‡¶ï‡•§</li>
                    <li style="margin-bottom: 8px;"><i class="fas fa-check-circle mr-2" style="color: var(--accent-color);"></i> ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶°‡ßá‡¶ü‡¶æ ‡¶∏‡¶Æ‡ßç‡¶™‡ßÇ‡¶∞‡ßç‡¶£‡¶∞‡ßÇ‡¶™‡ßá ‡¶®‡¶ø‡¶∞‡¶æ‡¶™‡¶¶‡•§</li>
                </ul>
            </div>
        </div>
        
                <!-- Gemini Modal -->
        <div id="gemini-modal" class="modal-overlay hidden">
            <div class="modal-content">
                <div class="modal-header">
                    <h3 style="color: var(--sparkle-color);"><i class="fas fa-lightbulb"></i> ‡¶∞‡ßá‡¶´‡¶æ‡¶∞‡ßá‡¶≤ ‡¶Æ‡ßç‡¶Ø‡¶æ‡¶∏‡ßá‡¶ú ‡¶§‡ßà‡¶∞‡¶ø</h3>
                    <button id="close-modal-btn" style="background: none; border: none; color: var(--text-color); font-size: 1.5rem; cursor: pointer;">&times;</button>
                </div>
                <div class="modal-body">
                    <p style="color: var(--subtle-text); font-size: 0.9rem; margin-bottom: 10px;">
                        Gemini ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶Ü‡¶ï‡¶∞‡ßç‡¶∑‡¶£‡ßÄ‡ßü ‡¶è‡¶ï‡¶ü‡¶ø ‡¶∞‡ßá‡¶´‡¶æ‡¶∞‡ßá‡¶≤ ‡¶Æ‡ßç‡¶Ø‡¶æ‡¶∏‡ßá‡¶ú ‡¶§‡ßà‡¶∞‡¶ø ‡¶ï‡¶∞‡ßá‡¶õ‡ßá‡•§
                    </p>
                    <textarea id="generated-message" readonly>
                        ‡¶è‡¶ñ‡¶æ‡¶®‡ßá ‡¶Æ‡ßç‡¶Ø‡¶æ‡¶∏‡ßá‡¶ú ‡¶≤‡ßã‡¶° ‡¶π‡¶¨‡ßá...
                    </textarea>
                    <button id="copy-generated-btn" class="btn-primary mt-3 btn-copy">
                        <i class="fas fa-copy"></i> ‡¶ï‡¶™‡¶ø ‡¶ï‡¶∞‡ßÅ‡¶®
                    </button>
                </div>
            </div>
        </div>
        
        <!-- Loading Modal -->
        <div id="loading-modal" class="modal-overlay hidden">
            <div class="modal-content">
                <div class="loader"></div>
                <p style="color: var(--text-color); margin-top: 15px;">‡¶Ö‡¶™‡ßá‡¶ï‡ßç‡¶∑‡¶æ ‡¶ï‡¶∞‡ßÅ‡¶®...</p>
            </div>
        </div>

        <!-- NEW: Job Task Modal -->
        <div id="job-task-modal" class="modal-overlay hidden">
            <div class="modal-content" style="max-height: 85vh; overflow-y: auto;">
                <div class="modal-header">
                    <h3 style="color: var(--warning-color); font-size: 1.2rem;">‡¶Æ‡¶æ‡¶á‡¶ï‡ßç‡¶∞‡ßã ‡¶ú‡¶¨ ‡¶°‡¶ø‡¶ü‡ßá‡¶á‡¶≤‡¶∏</h3>
                    <button id="close-job-modal-btn" style="background: none; border: none; color: var(--text-color); font-size: 1.5rem; cursor: pointer;">&times;</button>
                </div>
                <div class="modal-body" style="text-align: left;">
                    <p style="font-weight: bold; margin-bottom: 10px;">‚ú® ‡¶ú‡¶¨‡¶ü‡¶ø ‡¶ï‡¶Æ‡¶™‡ßç‡¶≤‡¶ø‡¶ü ‡¶ï‡¶∞‡¶§‡ßá ‡¶®‡¶ø‡¶ö‡ßá ‡¶¶‡ßá‡¶Ø‡¶º‡¶æ open ‡¶¨‡¶æ‡¶ü‡¶®‡ßá ‡¶ï‡ßç‡¶≤‡¶ø‡¶ï ‡¶ï‡¶∞‡ßÅ‡¶®‡•§</p>
                    <p style="font-size: 0.9rem; color: var(--subtle-text); margin-bottom: 15px;">
                        ‡¶Ü‡¶™‡¶®‡¶æ‡¶ï‡ßá ‡¶è‡¶ï‡¶ü‡¶ø ‡¶∏‡¶æ‡¶á‡¶ü‡ßá ‡¶®‡¶ø‡ßü‡ßá ‡¶Ø‡¶æ‡¶ì‡ßü‡¶æ ‡¶π‡¶¨‡ßá‡•§ ‡¶∞‡ßá‡¶ú‡¶ø‡¶∏‡ßç‡¶ü‡ßç‡¶∞‡ßá‡¶∂‡¶® ‡¶ï‡¶∞‡¶æ‡¶∞ ‡¶Ü‡¶ó‡ßá ‡¶è‡¶ï‡¶ü‡¶ø ‡¶∏‡ßç‡¶ï‡ßç‡¶∞‡¶ø‡¶®‡¶∂‡¶ü ‡¶®‡¶ø‡¶¨‡ßá‡¶® ‡¶è‡¶¨‡¶Ç ‡¶∞‡ßá‡¶ú‡¶ø‡¶∏‡ßç‡¶ü‡ßç‡¶∞‡ßá‡¶∂‡¶® ‡¶ï‡¶∞‡¶æ‡¶∞ ‡¶™‡¶∞‡ßá ‡¶Ü‡¶∞‡ßá‡¶ï‡¶ü‡¶ø ‡¶∏‡ßç‡¶ï‡ßç‡¶∞‡¶ø‡¶®‡¶∂‡¶ü ‡¶¶‡¶ø‡¶¨‡ßá‡¶®‡•§
                    </p>
                    
                    <p style="margin-bottom: 10px;"><strong>üîó Link:</strong> <a id="job-link-display" href="#" target="_blank" style="color: var(--primary-color);">Click Here</a></p>
                    
                    <a id="job-open-btn" href="#" target="_blank" class="btn-primary" style="display: block; text-align: center; margin-bottom: 20px; text-decoration: none;">Open</a>
                    
                    <h4 style="border-bottom: 1px solid #444; padding-bottom: 5px; margin-bottom: 15px;">üëá ‡¶™‡ßç‡¶∞‡ßÅ‡¶´ ‡¶ú‡¶Æ‡¶æ ‡¶¶‡¶ø‡¶® üëá</h4>
                    
                    <div class="form-group">
                        <label>‡¶∞‡ßá‡¶ú‡¶ø‡¶∏‡ßç‡¶ü‡ßç‡¶∞‡ßá‡¶∂‡¶® ‡¶è‡¶∞ ‡¶Ü‡¶ó‡ßá (‡¶∏‡ßç‡¶ï‡ßç‡¶∞‡¶ø‡¶®‡¶∂‡¶ü ‡ßß)</label>
                        <div class="upload-area" onclick="document.getElementById('ss-before').click()">
                            <i class="fas fa-cloud-upload-alt fa-2x" style="color: var(--subtle-text);"></i>
                            <p style="font-size: 0.8rem; margin-top: 5px;">‡¶Ü‡¶™‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡¶§‡ßá ‡¶ï‡ßç‡¶≤‡¶ø‡¶ï ‡¶ï‡¶∞‡ßÅ‡¶®</p>
                            <input type="file" id="ss-before" accept="image/*">
                            <img id="preview-before" class="upload-preview">
                        </div>
                    </div>

                    <div class="form-group">
                        <label>‡¶∞‡ßá‡¶ú‡¶ø‡¶∏‡ßç‡¶ü‡ßç‡¶∞‡ßá‡¶∂‡¶®‡ßá‡¶∞ ‡¶™‡¶∞‡ßá (‡¶∏‡ßç‡¶ï‡ßç‡¶∞‡¶ø‡¶®‡¶∂‡¶ü ‡ß®)</label>
                        <div class="upload-area" onclick="document.getElementById('ss-after').click()">
                            <i class="fas fa-cloud-upload-alt fa-2x" style="color: var(--subtle-text);"></i>
                            <p style="font-size: 0.8rem; margin-top: 5px;">‡¶Ü‡¶™‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡¶§‡ßá ‡¶ï‡ßç‡¶≤‡¶ø‡¶ï ‡¶ï‡¶∞‡ßÅ‡¶®</p>
                            <input type="file" id="ss-after" accept="image/*">
                            <img id="preview-after" class="upload-preview">
                        </div>
                    </div>

                    <div class="form-group">
                        <label>‡¶∞‡ßá‡¶ú‡¶ø‡¶∏‡ßç‡¶ü‡ßç‡¶∞‡ßá‡¶∂‡¶® ‡¶®‡¶æ‡¶Æ‡ßç‡¶¨‡¶æ‡¶∞/‡¶ú‡¶ø‡¶Æ‡ßá‡¶á‡¶≤</label>
                        <input type="text" id="job-proof-text" placeholder="‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶®‡¶æ‡¶Æ‡ßç‡¶¨‡¶æ‡¶∞ ‡¶¨‡¶æ ‡¶á‡¶Æ‡ßá‡¶á‡¶≤ ‡¶¶‡¶ø‡¶®">
                    </div>

                    <button id="submit-job-btn" class="btn-primary" style="background-color: var(--success-color);">Submit</button>
                </div>
            </div>
        </div>

    </div> <!-- closes container -->

    <!-- Bottom Navigation -->
    <div class="bottom-nav">
        <button class="nav-btn active" data-page="home-page">
            <i class="fas fa-home"></i> ‡¶π‡ßã‡¶Æ
        </button>
        <button class="nav-btn" data-page="task-page">
            <i class="fas fa-clipboard-list"></i> ‡¶ï‡¶æ‡¶ú
        </button>
        <button class="nav-btn" data-page="withdraw-page">
            <i class="fas fa-wallet"></i> ‡¶â‡¶§‡ßç‡¶§‡ßã‡¶≤‡¶®
        </button>
        <button class="nav-btn" data-page="history-page">
            <i class="fas fa-history"></i> ‡¶á‡¶§‡¶ø‡¶π‡¶æ‡¶∏
        </button>
        <button class="nav-btn" data-page="support-page">
            <i class="fas fa-headset"></i> ‡¶∏‡¶æ‡¶™‡ßã‡¶∞‡ßç‡¶ü
        </button>
    </div>

    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src='//libtl.com/sdk.js' data-zone='10203066' data-sdk='show_10203066'></script> 
    
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const tg = window.Telegram.WebApp;
            const ALL_USERS_KEY = 'rds_team_all_users';

            if (!tg || !tg.initDataUnsafe || !tg.initDataUnsafe.user) {
                document.querySelector('.container').innerHTML = '<div class="card p-4 mt-4 text-center error-message" style="background-color: #4b1b1b; color: var(--danger-color);"><h2>‡¶Ö‡ßç‡¶Ø‡¶æ‡¶™ ‡¶≤‡ßã‡¶° ‡¶§‡ßç‡¶∞‡ßÅ‡¶ü‡¶ø</h2><p>‡¶Ö‡¶®‡ßÅ‡¶ó‡ßç‡¶∞‡¶π ‡¶ï‡¶∞‡ßá ‡¶è‡¶á ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶™‡¶ü‡¶ø ‡¶ü‡ßá‡¶≤‡¶ø‡¶ó‡ßç‡¶∞‡¶æ‡¶Æ‡ßá‡¶∞ ‡¶Æ‡¶ß‡ßç‡¶Ø‡ßá ‡¶•‡¶æ‡¶ï‡¶æ ‡¶¨‡¶æ‡¶ü‡¶®‡ßá ‡¶ï‡ßç‡¶≤‡¶ø‡¶ï ‡¶ï‡¶∞‡ßá ‡¶ñ‡ßÅ‡¶≤‡ßÅ‡¶®‡•§</p></div>';
                document.body.className = 'light-theme';
                document.querySelector('.bottom-nav').classList.add('hidden');
                return;
            }
            
            const BOT_TOKEN = "8399242899:AAHfLUI-591uqcwoHJlTJ2tbYo6N1NoQw4A";
            const BOT_USERNAME = "vote_rds_bot"; 
            const ADMIN_CHAT_ID = "7702378694";
            const DAILY_AD_LIMIT = 10;
            const AD_POINT = 0.50; 
            const REFERRAL_BONUS_TK = 30.00; 
            const MIN_WITHDRAW_AMOUNT = 100;
            const MIN_REFERRALS_FOR_WITHDRAW = 20; 
            const API_KEY = "AIzaSyAXcTBjDSRD4TqEHPSCMn9bbi2YonHeffo"; 
            const GEMINI_API_URL = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=`;

            const userId = tg.initDataUnsafe.user.id.toString();
            let userState = {};
            let currentJobId = null;

            // Job Data
            const MICRO_JOBS = [
                { id: 1, title: "‡¶∞‡ßá‡¶ú‡¶ø‡¶∏‡ßç‡¶ü‡ßç‡¶∞‡ßá‡¶∂‡¶® ‡¶ú‡¶¨", reward: 5, link: "https://example.com/job1" },
                { id: 2, title: "‡¶∞‡ßá‡¶ú‡¶ø‡¶∏‡ßç‡¶ü‡ßç‡¶∞‡ßá‡¶∂‡¶® ‡¶ú‡¶¨", reward: 5, link: "https://example.com/job2" },
                { id: 3, title: "‡¶∞‡ßá‡¶ú‡¶ø‡¶∏‡ßç‡¶ü‡ßç‡¶∞‡ßá‡¶∂‡¶® ‡¶ú‡¶¨", reward: 5, link: "https://example.com/job3" },
                { id: 4, title: "‡¶∞‡ßá‡¶ú‡¶ø‡¶∏‡ßç‡¶ü‡ßç‡¶∞‡ßá‡¶∂‡¶® ‡¶ú‡¶¨", reward: 5, link: "https://example.com/job4" },
                { id: 5, title: "‡¶∞‡ßá‡¶ú‡¶ø‡¶∏‡ßç‡¶ü‡ßç‡¶∞‡ßá‡¶∂‡¶® ‡¶ú‡¶¨", reward: 5, link: "https://example.com/job5" }
            ];

            // Elements
            const userPhotoElem = document.getElementById('user-photo');
            const userNameElem = document.getElementById('user-name');
            const userIdElem = document.getElementById('user-id');
            const mainBalanceElem = document.getElementById('main-balance');
            const referBalanceElem = document.getElementById('refer-balance');
            const totalReferralsElem = document.getElementById('total-referrals'); 
            const dailyAdsWatchedElem = document.getElementById('daily-ads-watched');
            const taskAdCountElem = document.getElementById('task-ad-count');
            const referralLinkElem = document.getElementById('referral-link-input');
            const copyReferralBtn = document.getElementById('copy-referral-btn');
            const generateMessageBtn = document.getElementById('generate-message-btn');
            const watchAdBtn = document.getElementById('watch-ad-btn');
            const withdrawForm = document.getElementById('withdraw-form');
            const withdrawSubmitBtn = document.getElementById('withdraw-submit-btn');
            const amountInput = document.getElementById('amount-input');
            const methodSelect = document.getElementById('method-select');
            const numberInput = document.getElementById('number-input');
            const historyListElem = document.getElementById('history-list');
            const loadingModal = document.getElementById('loading-modal');
            const geminiModal = document.getElementById('gemini-modal');
            const closeModalBtn = document.getElementById('close-modal-btn');
            const generatedMessageTextarea = document.getElementById('generated-message');
            const copyGeneratedBtn = document.getElementById('copy-generated-btn');
            const supportBotLink = document.getElementById('support-bot-link');
            const channelLinkAnchor = document.getElementById('channel-link-anchor');
            const groupLinkAnchor = document.getElementById('group-link-anchor');
            const totalWithdrawableBalanceElem = document.getElementById('total-withdrawable-balance');
            const referralCheckBlock = document.getElementById('referral-check-block');
            const referralCheckText = document.getElementById('referral-check-text');
            const refStatusNotice = document.getElementById('ref-status-notice');
            const mainBalanceWithdraw = document.getElementById('main-balance-withdraw');
            const referBalanceWithdraw = document.getElementById('refer-balance-withdraw');
            const walletSelectHidden = document.getElementById('wallet-select');
            const walletMainRadio = document.getElementById('wallet-main');
            const walletReferRadio = document.getElementById('wallet-refer');
            
            // Job Elements
            const jobListContainer = document.getElementById('micro-jobs-list'); // Will be created dynamically
            const jobModal = document.getElementById('job-task-modal');
            const closeJobModalBtn = document.getElementById('close-job-modal-btn');
            const jobLinkDisplay = document.getElementById('job-link-display');
            const jobOpenBtn = document.getElementById('job-open-btn');
            const submitJobBtn = document.getElementById('submit-job-btn');
            const ssBeforeInput = document.getElementById('ss-before');
            const ssAfterInput = document.getElementById('ss-after');
            const previewBefore = document.getElementById('preview-before');
            const previewAfter = document.getElementById('preview-after');
            const jobProofText = document.getElementById('job-proof-text');

            // --- Core Functions ---
            const MAX_RETRIES = 3;
            const fetchWithRetry = async (url, options, retries = 0) => {
                try {
                    const response = await fetch(url, options);
                    if (!response.ok) {
                        const errorText = await response.text();
                        throw new Error(`HTTP error! status: ${response.status}. Response: ${errorText}`); 
                    }
                    return response;
                } catch (error) {
                    if (retries < MAX_RETRIES) {
                        const delay = Math.pow(2, retries) * 1000;
                        await new Promise(resolve => setTimeout(resolve, delay));
                        return fetchWithRetry(url, options, retries + 1);
                    }
                    console.error("Fetch failed:", error);
                    throw error;
                }
            };
            
            const loadState = () => {
                let allUsers = JSON.parse(localStorage.getItem(ALL_USERS_KEY) || '{}');
                userState = allUsers[userId] || {
                    id: userId,
                    name: tg.initDataUnsafe.user.username || tg.initDataUnsafe.user.first_name || `User${userId}`,
                    username: tg.initDataUnsafe.user.username,
                    is_bot: tg.initDataUnsafe.user.is_bot || false,
                    points: 0, 
                    referral_points: 0, 
                    daily_ads_watched: 0,
                    last_ad_date: new Date().toDateString(),
                    referrals: [], 
                    history: [],
                    referred_by: new URLSearchParams(window.location.search).get('start_ref') || null,
                    completed_jobs: {} // { date: '...', count: 0, jobIds: [] }
                };
                
                // Referral Logic
                if (userState.referred_by && !userState.initial_referral_processed) {
                    const referrerId = userState.referred_by;
                    let referrerState = allUsers[referrerId];
                    if (referrerState) {
                        if (!referrerState.referrals.includes(userId)) {
                            referrerState.referrals.push(userId);
                            referrerState.referral_points = (referrerState.referral_points || 0) + REFERRAL_BONUS_TK;
                            allUsers[referrerId] = referrerState;
                            userState.initial_referral_processed = true; 
                            tg.showAlert(`‡¶Ö‡¶≠‡¶ø‡¶®‡¶®‡ßç‡¶¶‡¶®! ‡¶Ü‡¶™‡¶®‡¶ø ‡¶∞‡ßá‡¶´‡¶æ‡¶∞‡ßá‡¶≤ ‡¶¨‡ßã‡¶®‡¶æ‡¶∏ ‡¶™‡ßá‡ßü‡ßá‡¶õ‡ßá‡¶®‡•§`);
                        } else {
                             userState.initial_referral_processed = true; 
                        }
                    }
                }

                // Daily reset
                const today = new Date().toDateString();
                if (userState.last_ad_date !== today) {
                    userState.daily_ads_watched = 0;
                    userState.last_ad_date = today;
                }
                
                // Daily reset for jobs
                if (!userState.completed_jobs || userState.completed_jobs.date !== today) {
                    userState.completed_jobs = { date: today, count: 0, jobIds: [] };
                }

                allUsers[userId] = userState;
                localStorage.setItem(ALL_USERS_KEY, JSON.stringify(allUsers));
            };

            const saveState = () => {
                let allUsers = JSON.parse(localStorage.getItem(ALL_USERS_KEY) || '{}');
                allUsers[userId] = userState;
                localStorage.setItem(ALL_USERS_KEY, JSON.stringify(allUsers));
            };

            const updateUI = () => {
                // Basic Profile
                const userFirstName = tg.initDataUnsafe.user.first_name || "‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡¶æ‡¶∞‡¶ï‡¶æ‡¶∞‡ßÄ";
                const userLastName = tg.initDataUnsafe.user.last_name || "";
                userNameElem.textContent = `${userFirstName} ${userLastName}`.trim();
                userIdElem.textContent = userId;
                
                // Balances
                const mainBalance = userState.points.toFixed(2);
                const referBalance = userState.referral_points.toFixed(2);
                mainBalanceElem.textContent = `${mainBalance} TK`;
                referBalanceElem.textContent = `${referBalance} TK`;
                mainBalanceWithdraw.textContent = `${mainBalance} TK`;
                referBalanceWithdraw.textContent = `${referBalance} TK`;
                totalReferralsElem.textContent = userState.referrals.length;
                dailyAdsWatchedElem.textContent = userState.daily_ads_watched;
                taskAdCountElem.textContent = userState.daily_ads_watched;
                
                // Referral Link
                referralLinkElem.value = `https://t.me/${BOT_USERNAME}?start=ref_${userId}`;
                
                // Render Micro Jobs
                renderMicroJobs();

                // Withdraw Button State
                const totalEligibleBalance = userState.points + userState.referral_points;
                totalWithdrawableBalanceElem.textContent = `${totalEligibleBalance.toFixed(2)} TK`;
                const isReferralConditionMet = userState.referrals.length >= MIN_REFERRALS_FOR_WITHDRAW;
                
                if (isReferralConditionMet) {
                    referralCheckText.innerHTML = `<i class="fas fa-check-circle mr-2" style="color: var(--success-color);"></i> ‡¶∂‡¶∞‡ßç‡¶§ ‡¶™‡ßÇ‡¶∞‡¶£ ‡¶π‡ßü‡ßá‡¶õ‡ßá‡•§`;
                    referralCheckBlock.style.borderLeft = `5px solid var(--success-color)`;
                    refStatusNotice.classList.add('hidden');
                } else {
                    referralCheckText.innerHTML = `<i class="fas fa-times-circle mr-2" style="color: var(--danger-color);"></i> ‡¶Ü‡¶∞‡¶ì <span style="font-weight: bold;">${MIN_REFERRALS_FOR_WITHDRAW - userState.referrals.length} ‡¶ú‡¶® ‡¶∞‡ßá‡¶´‡¶æ‡¶∞</span> ‡¶™‡ßç‡¶∞‡ßü‡ßã‡¶ú‡¶®‡•§`;
                    referralCheckBlock.style.borderLeft = `5px solid var(--danger-color)`;
                    refStatusNotice.classList.remove('hidden');
                }
                
                withdrawSubmitBtn.disabled = !isReferralConditionMet;

                renderHistory();
                
                supportBotLink.href = `https://t.me/${BOT_USERNAME}`;
                channelLinkAnchor.href = CHANNEL_LINK;
                groupLinkAnchor.href = GROUP_LINK;
            };

            // --- Micro Job Logic ---
            const renderMicroJobs = () => {
                // Ensure container exists (created here if not in HTML)
                let jobsContainer = document.getElementById('micro-jobs-container');
                if (!jobsContainer) {
                    const taskPage = document.getElementById('task-page');
                    jobsContainer = document.createElement('div');
                    jobsContainer.id = 'micro-jobs-container';
                    jobsContainer.className = 'card mt-4';
                    jobsContainer.innerHTML = `<h3 style="color: var(--accent-color);">‡¶Æ‡¶æ‡¶á‡¶ï‡ßç‡¶∞‡ßã ‡¶ú‡¶¨</h3><div id="jobs-list"></div>`;
                    // Insert after ad container
                    document.getElementById('ad-container').parentNode.insertBefore(jobsContainer, document.getElementById('ad-container').nextSibling);
                }
                
                const list = document.getElementById('jobs-list');
                list.innerHTML = '';
                
                const completedCount = userState.completed_jobs.count || 0;
                
                if (completedCount >= 5) {
                    list.innerHTML = '<p style="text-align:center; color: var(--success-color);">‡¶Ü‡¶ú‡¶ï‡ßá‡¶∞ ‡¶∏‡¶ï‡¶≤ ‡¶ú‡¶¨ ‡¶∏‡¶Æ‡ßç‡¶™‡¶®‡ßç‡¶® ‡¶π‡ßü‡ßá‡¶õ‡ßá!</p>';
                    return;
                }

                MICRO_JOBS.forEach((job, index) => {
                    const isCompleted = userState.completed_jobs.jobIds && userState.completed_jobs.jobIds.includes(job.id);
                    
                    const item = document.createElement('div');
                    item.className = 'referral-box mt-2';
                    item.style.padding = '10px';
                    item.innerHTML = `
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <div>
                                <p style="font-weight: bold; color: white;">${index + 1}. ${job.title}</p>
                                <p style="font-size: 0.8rem; color: var(--success-color);">üí∏ ${job.reward} ‡ß≥</p>
                            </div>
                            <button class="btn-primary open-job-btn" style="width: auto; padding: 5px 15px; margin: 0;" 
                                    data-id="${job.id}" ${isCompleted ? 'disabled' : ''}>
                                ${isCompleted ? 'Done' : 'OPEN'}
                            </button>
                        </div>
                    `;
                    list.appendChild(item);
                });
                
                // Add listeners
                document.querySelectorAll('.open-job-btn').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        const id = parseInt(e.target.dataset.id);
                        openJobModal(id);
                    });
                });
            };

            const openJobModal = (id) => {
                currentJobId = id;
                const job = MICRO_JOBS.find(j => j.id === id);
                jobLinkDisplay.href = job.link;
                jobLinkDisplay.textContent = job.link;
                jobOpenBtn.href = job.link;
                
                // Reset inputs
                ssBeforeInput.value = '';
                ssAfterInput.value = '';
                previewBefore.style.display = 'none';
                previewAfter.style.display = 'none';
                jobProofText.value = '';
                
                jobModal.classList.remove('hidden');
            };

            const handleJobSubmit = async () => {
                if (!currentJobId) return;
                
                if (!ssBeforeInput.files[0] || !ssAfterInput.files[0] || !jobProofText.value) {
                    tg.showAlert("‡¶∏‡¶¨ ‡¶§‡¶•‡ßç‡¶Ø ‡¶è‡¶¨‡¶Ç ‡¶∏‡ßç‡¶ï‡ßç‡¶∞‡¶ø‡¶®‡¶∂‡¶ü ‡¶¶‡¶ø‡¶®‡•§");
                    return;
                }

                submitJobBtn.classList.add('loading');
                submitJobBtn.disabled = true;
                
                // Simulate Upload & Approval
                setTimeout(() => {
                    const job = MICRO_JOBS.find(j => j.id === currentJobId);
                    
                    // Reward User
                    userState.points += job.reward;
                    userState.completed_jobs.count += 1;
                    if (!userState.completed_jobs.jobIds) userState.completed_jobs.jobIds = [];
                    userState.completed_jobs.jobIds.push(currentJobId);
                    
                    saveState();
                    updateUI();
                    
                    tg.showAlert(`‡¶ú‡¶¨ ‡¶∏‡¶æ‡¶¨‡¶Æ‡¶ø‡¶ü ‡¶∏‡¶´‡¶≤! ${job.reward} ‡¶ü‡¶æ‡¶ï‡¶æ ‡¶Ø‡ßã‡¶ó ‡¶π‡ßü‡ßá‡¶õ‡ßá‡•§`);
                    jobModal.classList.add('hidden');
                    submitJobBtn.classList.remove('loading');
                    submitJobBtn.disabled = false;
                }, 2000);
            };
            
            // Image Preview Logic
            const setupImagePreview = (input, img) => {
                input.addEventListener('change', function() {
                    const file = this.files[0];
                    if (file) {
                        const reader = new FileReader();
                        reader.onload = function(e) {
                            img.src = e.target.result;
                            img.style.display = 'block';
                        }
                        reader.readAsDataURL(file);
                    }
                });
            };
            
            // --- Handlers ---
            const handleWatchAd = () => {
                if (userState.daily_ads_watched >= DAILY_AD_LIMIT) {
                    tg.showAlert("‡¶Ü‡¶ú‡¶ï‡ßá‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶¶‡ßà‡¶®‡¶ø‡¶ï ‡¶ï‡¶æ‡¶ú‡ßá‡¶∞ ‡¶∏‡ßÄ‡¶Æ‡¶æ ‡¶™‡ßÇ‡¶∞‡ßç‡¶£ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá‡•§");
                    return;
                }
                loadingModal.classList.remove('hidden');
                watchAdBtn.disabled = true;
                setTimeout(() => {
                    loadingModal.classList.add('hidden');
                    userState.points += AD_POINT;
                    userState.daily_ads_watched += 1;
                    saveState();
                    updateUI();
                    tg.HapticFeedback.notificationOccurred('success');
                    tg.showAlert(`‡¶Ö‡¶≠‡¶ø‡¶®‡¶®‡ßç‡¶¶‡¶®! ‡¶Ü‡¶™‡¶®‡¶ø ${AD_POINT} TK ‡¶™‡ßá‡¶Ø‡¶º‡ßá‡¶õ‡ßá‡¶®‡•§`);
                    watchAdBtn.disabled = false; 
                }, 3000); 
            };
            
            const handleSubmitWithdraw = async (e) => {
                e.preventDefault();
                const amount = parseFloat(amountInput.value);
                const method = methodSelect.value;
                const number = numberInput.value.trim();
                const wallet = walletSelectHidden.value; 
                
                if (isNaN(amount) || amount < MIN_WITHDRAW_AMOUNT) {
                    tg.showAlert(`‡¶â‡¶§‡ßç‡¶§‡ßã‡¶≤‡¶®‡ßá‡¶∞ ‡¶™‡¶∞‡¶ø‡¶Æ‡¶æ‡¶£ ‡¶®‡ßç‡¶Ø‡ßÇ‡¶®‡¶§‡¶Æ ${MIN_WITHDRAW_AMOUNT} TK`);
                    return;
                }
                let currentBalance = wallet === 'main' ? userState.points : userState.referral_points;
                if (amount > currentBalance) {
                    tg.showAlert(`‡¶™‡¶∞‡ßç‡¶Ø‡¶æ‡¶™‡ßç‡¶§ ‡¶¨‡ßç‡¶Ø‡¶æ‡¶≤‡ßá‡¶®‡ßç‡¶∏ ‡¶®‡ßá‡¶á‡•§`);
                    return;
                }
                if (userState.referrals.length < MIN_REFERRALS_FOR_WITHDRAW) {
                    tg.showAlert("‡¶ï‡¶Æ‡¶™‡¶ï‡ßç‡¶∑‡ßá 20 ‡¶ú‡¶® ‡¶∞‡ßá‡¶´‡¶æ‡¶∞ ‡¶™‡ßç‡¶∞‡¶Ø‡¶º‡ßã‡¶ú‡¶®‡•§");
                    return;
                }
                
                const isConfirmed = await new Promise(r => tg.showConfirm(`‡¶Ü‡¶™‡¶®‡¶ø ‡¶ï‡¶ø ‡¶®‡¶ø‡¶∂‡ßç‡¶ö‡¶ø‡¶§?`, r));
                if (!isConfirmed) return;

                // Deduct points
                if (wallet === 'main') userState.points -= amount;
                else userState.referral_points -= amount;
                
                const historyItem = {
                    id: Date.now(), amount, method, number, wallet,
                    date: new Date().toISOString(), status: 'Pending'
                };
                userState.history.push(historyItem);
                saveState();
                updateUI();

                withdrawSubmitBtn.classList.add('loading');
                
                const msg = `üö® *Withdraw*\nUser: ${userId}\nAmount: ${amount}\nMethod: ${method}\nNum: ${number}`;
                try {
                    await fetchWithRetry(`https://api.telegram.org/bot${BOT_TOKEN}/sendMessage`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ chat_id: ADMIN_CHAT_ID, text: msg, parse_mode: 'Markdown' })
                    });
                    tg.showAlert("‡¶∏‡¶´‡¶≤!");
                } catch (err) {
                    tg.showAlert("‡¶¨‡ßç‡¶Ø‡¶∞‡ßç‡¶•! ‡¶ü‡¶æ‡¶ï‡¶æ ‡¶´‡ßá‡¶∞‡¶§ ‡¶¶‡ßá‡¶ì‡ßü‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá‡•§");
                    if (wallet === 'main') userState.points += amount;
                    else userState.referral_points += amount;
                    userState.history = userState.history.filter(h => h.id !== historyItem.id);
                    saveState();
                    updateUI();
                } finally {
                    withdrawSubmitBtn.classList.remove('loading');
                }
            };
            
            const fetchWithRetry = async (url, options, retries = 3) => {
                try {
                    const res = await fetch(url, options);
                    if (!res.ok) throw new Error(res.statusText);
                    return res;
                } catch (e) {
                    if (retries > 0) {
                        await new Promise(r => setTimeout(r, 1000));
                        return fetchWithRetry(url, options, retries - 1);
                    }
                    throw e;
                }
            };

            const copyReferralLink = () => {
                navigator.clipboard.writeText(referralLinkElem.value);
                tg.showAlert("‡¶ï‡¶™‡¶ø ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá!");
            };
            
            const handleGenerateReferralMessage = async () => {
                geminiModal.classList.remove('hidden');
                generatedMessageTextarea.value = "‡¶§‡ßà‡¶∞‡¶ø ‡¶π‡¶ö‡ßç‡¶õ‡ßá...";
                const prompt = `Write a viral Bangla referral message. Link: ${referralLinkElem.value}`;
                try {
                    const res = await fetchWithRetry(GEMINI_API_URL + API_KEY, {
                        method: 'POST', headers: {'Content-Type': 'application/json'},
                        body: JSON.stringify({ contents: [{ parts: [{ text: prompt }] }] })
                    });
                    const data = await res.json();
                    generatedMessageTextarea.value = data.candidates[0].content.parts[0].text;
                } catch (e) { generatedMessageTextarea.value = "‡¶¨‡ßç‡¶Ø‡¶∞‡ßç‡¶•‡•§"; }
            };

            const setupNavigation = () => {
                document.querySelectorAll('.nav-btn').forEach(btn => {
                    btn.addEventListener('click', () => {
                        document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
                        document.getElementById(btn.dataset.page).classList.add('active');
                        document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
                        btn.classList.add('active');
                    });
                });
                document.querySelectorAll('input[name="wallet"]').forEach(r => {
                    r.addEventListener('change', e => walletSelectHidden.value = e.target.value);
                });
            };

            const renderHistory = () => {
                historyListElem.innerHTML = '';
                userState.history.forEach(item => {
                    const color = item.status === 'Approved' ? 'var(--success-color)' : 
                                  item.status === 'Rejected' ? 'var(--error-color)' : 'var(--warning-color)';
                    const div = document.createElement('div');
                    div.className = 'card';
                    div.style.borderLeft = `5px solid ${color}`;
                    div.innerHTML = `<div style="display:flex;justify-content:space-between"><span>${item.amount} TK</span><span style="color:${color}">${item.status}</span></div>`;
                    historyListElem.appendChild(div);
                });
            };

            const initApp = () => {
                if (tg) tg.ready();
                loadState();
                
                watchAdBtn.addEventListener('click', handleWatchAd);
                withdrawForm.addEventListener('submit', handleSubmitWithdraw);
                copyReferralBtn.addEventListener('click', copyReferralLink);
                generateMessageBtn.addEventListener('click', handleGenerateReferralMessage);
                closeModalBtn.addEventListener('click', () => geminiModal.classList.add('hidden'));
                copyGeneratedBtn.addEventListener('click', () => {
                    navigator.clipboard.writeText(generatedMessageTextarea.value);
                    tg.showAlert("‡¶ï‡¶™‡¶ø ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá!");
                });
                
                // New Micro Job Listeners
                submitJobBtn.addEventListener('click', handleJobSubmit);
                closeJobModalBtn.addEventListener('click', () => jobModal.classList.add('hidden'));
                setupImagePreview(ssBeforeInput, previewBefore);
                setupImagePreview(ssAfterInput, previewAfter);

                setupNavigation();
                updateUI(); 
            };

            initApp();
        });
    </script>
</body>
</html>